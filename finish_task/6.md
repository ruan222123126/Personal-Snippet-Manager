æ—¢ç„¶ä½ ç¡®è®¤ Web ç«¯å½•å…¥åŠŸèƒ½ï¼ˆç¬¬å››é˜¶æ®µï¼‰å·²ç»å®Œæˆï¼Œé‚£æˆ‘ä»¬å°±è¿›å…¥æ•´ä¸ªç³»ç»Ÿæœ€ç¡¬æ ¸ã€æœ€èƒ½ä½“ç°â€œå¼€å‘è€…å·¥å…·â€å±æ€§çš„éƒ¨åˆ†ã€‚

**ç¬¬äº”é˜¶æ®µï¼šæ„å»ºå‘½ä»¤è¡Œå·¥å…· (CLI)**

è¿™ä¸€æ­¥çš„ç›®æ ‡æ˜¯è®©ä½ æ— éœ€ç¦»å¼€ç»ˆç«¯ï¼Œå°±èƒ½å®Œæˆä»£ç ç‰‡æ®µçš„**æœç´¢**ã€**å¤åˆ¶**å’Œ**å½•å…¥**ã€‚æˆ‘ä»¬å°†å®Œå…¨æŒ‰ç…§æ¶æ„æŠ¥å‘Šä¸­çš„è®¾è®¡ï¼Œå¤„ç†å¤æ‚çš„è·¨å¹³å°å‰ªè´´æ¿é—®é¢˜ï¼Œå¹¶é›†æˆç³»ç»Ÿé»˜è®¤ç¼–è¾‘å™¨ï¼ˆå¦‚ Vim/Nanoï¼‰ã€‚

è¯·æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š

### ç¬¬äº”é˜¶æ®µï¼šCLI å·¥å…·å¼€å‘

#### 1. å®‰è£… CLI ä¾èµ–

æˆ‘ä»¬éœ€è¦ `commander` åšå‘½ä»¤è§£æï¼Œ`inquirer` åšäº¤äº’ï¼Œ`chalk` åšç€è‰²ï¼Œä»¥åŠ `execa` æ¥å¤„ç†åº•å±‚ç³»ç»Ÿè°ƒç”¨ï¼ˆè§£å†³å‰ªè´´æ¿é—®é¢˜ï¼‰ã€‚

* **åŠ¨ä½œ**ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š
```bash
npm install commander inquirer@9 chalk@5 node-fetch clipboardy execa

```


*(æ³¨ï¼šè¿™é‡ŒæŒ‡å®šç‰ˆæœ¬æ˜¯ä¸ºäº†ç¡®ä¿å…¨æ˜¯ ESM æ¨¡å—ï¼Œä¸ä½ çš„ Next.js é¡¹ç›®é…ç½®ä¿æŒä¸€è‡´)*

#### 2. å°è£… API å®¢æˆ·ç«¯

CLI éœ€è¦ä¸ä½ è¿è¡Œåœ¨ `localhost:3000` çš„ Next.js API é€šä¿¡ã€‚

* **åŠ¨ä½œ**ï¼šåˆ›å»º `cli/api.js`ã€‚
* **é€»è¾‘**ï¼š
* å®šä¹‰ `API_BASE = 'http://localhost:3000/api/snippets'`;
* å¯¼å‡º `searchSnippets(query)`: å‘é€ GET è¯·æ±‚ã€‚
* å¯¼å‡º `createSnippet(data)`: å‘é€ POST è¯·æ±‚ã€‚



#### 3. è§£å†³å‰ªè´´æ¿éš¾é¢˜ (Linux Wayland é€‚é…)

è¿™æ˜¯æŠ¥å‘Šä¸­çš„æŠ€æœ¯éš¾ç‚¹ã€‚æ ‡å‡†åº“åœ¨ Linux Wayland ä¸‹å¾€å¾€å¤±æ•ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ fallbackã€‚

* **åŠ¨ä½œ**ï¼šåˆ›å»º `cli/utils/clipboard.js`ã€‚
* **ä»£ç å‚è€ƒ**ï¼ˆç›´æ¥å¤ç”¨æŠ¥å‘Šé€»è¾‘ï¼‰ï¼š
```javascript
import clipboardy from 'clipboardy';
import { execa } from 'execa';

export async function copyToClipboard(text) {
  try {
    // 1. å°è¯•é€šç”¨æ–¹æ¡ˆ (Mac/Windows/X11)
    await clipboardy.write(text);
  } catch (err) {
    // 2. Linux Wayland é™çº§æ–¹æ¡ˆ
    if (process.env.XDG_SESSION_TYPE === 'wayland') {
      try {
        await execa('wl-copy', { input: text });
        return;
      } catch (e) {
        console.error('âŒ Wayland clipboard failed. Install wl-clipboard.');
        throw e;
      }
    }
    throw err;
  }
}

```



#### 4. å®ç°æ ¸å¿ƒå‘½ä»¤ (Search & Add)

* **åŠ¨ä½œ**ï¼šåˆ›å»º `cli/index.js` ä½œä¸ºå…¥å£æ–‡ä»¶ã€‚
* **ä»»åŠ¡ A (Add å‘½ä»¤)**ï¼š
* ä½¿ç”¨ `commander` å®šä¹‰ `add` å‘½ä»¤ã€‚
* ä½¿ç”¨ `inquirer` å‘èµ·é—®ç­”æµç¨‹ï¼š
* Title (input)
* Language (list, æä¾›å¸¸è§é€‰é¡¹)
* **Code (editor)**: è¿™éå¸¸å…³é”®ï¼Œè®¾ç½® `type: 'editor'`ï¼Œinquirer ä¼šè‡ªåŠ¨æ‰“å¼€ Vim/Nano/Code è®©ä½ ç²˜è´´ä»£ç ã€‚
* Tags (input, é€—å·åˆ†éš”)


* è°ƒç”¨ `createSnippet` APIã€‚


* **ä»»åŠ¡ B (Search å‘½ä»¤)**ï¼š
* å®šä¹‰ `search [query]` å‘½ä»¤ã€‚
* è°ƒç”¨ `searchSnippets` APIã€‚
* ä½¿ç”¨ `inquirer` çš„ `list` ç±»å‹å±•ç¤ºç»“æœåˆ—è¡¨ (æ˜¾ç¤º Title + Language)ã€‚
* ç”¨æˆ·å›è½¦é€‰ä¸­åï¼Œè°ƒç”¨ä¸Šé¢çš„ `copyToClipboard` å°†ä»£ç æ”¾å…¥å‰ªè´´æ¿ã€‚
* æ‰“å°æˆåŠŸæç¤ºï¼šâ€œâœ… Copied to clipboard!â€



---

### ğŸ’¡ æ ¸å¿ƒä»£ç å‚è€ƒ

**`cli/index.js` (å…¥å£éª¨æ¶)**

```javascript
#!/usr/bin/env node
import { program } from 'commander';
import inquirer from 'inquirer';
import chalk from 'chalk';
import { searchSnippets, createSnippet } from './api.js';
import { copyToClipboard } from './utils/clipboard.js';

program
  .version('1.0.0')
  .description('Personal Snippet Manager CLI');

// --- Search Command ---
program
  .command('search [query]')
  .alias('s')
  .description('Search snippets and copy to clipboard')
  .action(async (query) => {
    try {
      const snippets = await searchSnippets(query);
      
      if (snippets.length === 0) {
        console.log(chalk.yellow('No snippets found.'));
        return;
      }

      const { selectedId } = await inquirer.prompt([
        {
          type: 'list',
          name: 'selectedId',
          message: 'Select a snippet to copy:',
          choices: snippets.map(s => ({
            name: `${chalk.bold(s.title)} ${chalk.dim(`(${s.language})`)}`,
            value: s.id
          })),
          pageSize: 10
        }
      ]);

      const selectedSnippet = snippets.find(s => s.id === selectedId);
      await copyToClipboard(selectedSnippet.code);
      console.log(chalk.green(`\nâœ… Copied "${selectedSnippet.title}" to clipboard!`));

    } catch (error) {
      console.error(chalk.red('Error:'), error.message);
    }
  });

// --- Add Command ---
program
  .command('add')
  .alias('new')
  .description('Create a new snippet')
  .action(async () => {
    const answers = await inquirer.prompt([
      { type: 'input', name: 'title', message: 'Title:' },
      { 
        type: 'list', 
        name: 'language', 
        message: 'Language:', 
        choices: ['javascript', 'typescript', 'python', 'bash', 'sql', 'text'] 
      },
      { 
        type: 'editor', 
        name: 'code', 
        message: 'Press <Enter> to open editor for code:',
      },
      { type: 'input', name: 'tags', message: 'Tags (comma separated):' }
    ]);

    // å¤„ç† tags å­—ç¬¦ä¸²è½¬æ•°ç»„
    const payload = {
      ...answers,
      tags: answers.tags.split(',').map(t => t.trim()).filter(Boolean)
    };

    try {
      await createSnippet(payload);
      console.log(chalk.green('\nâœ… Snippet created successfully!'));
    } catch (error) {
      console.error(chalk.red('Failed to create snippet. Is the server running?'));
    }
  });

program.parse(process.argv);

```

---

### âœ… éªŒæ”¶æ ‡å‡†

1. **ç¯å¢ƒå‡†å¤‡**ï¼š`node cli/index.js` èƒ½è·‘èµ·æ¥ï¼ˆè®°å¾—å…ˆ `npm run dev` å¯åŠ¨ API æœåŠ¡ï¼‰ã€‚
2. **å½•å…¥æµ‹è¯•**ï¼šè¿è¡Œ `node cli/index.js add` -> å¡«å…¥ä¿¡æ¯ -> è‡ªåŠ¨å¼¹å‡º Vim/Nano -> ä¿å­˜å…³é—­ -> æç¤ºæˆåŠŸã€‚
3. **æœç´¢æµ‹è¯•**ï¼šè¿è¡Œ `node cli/index.js search` -> çœ‹åˆ°åˆšæ‰å½•å…¥çš„æ¡ç›® -> é€‰æ‹© -> æç¤ºå¤åˆ¶æˆåŠŸ -> åœ¨ä»»æ„åœ°æ–¹ç²˜è´´éªŒè¯ã€‚

**å®Œæˆåï¼Œè¯·å‘Šè¯‰æˆ‘ä½ åœ¨ CLI é‡ŒæˆåŠŸâ€œSearchâ€å¹¶â€œCopyâ€çš„ä½“éªŒå¦‚ä½•ï¼**