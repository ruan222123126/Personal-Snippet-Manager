# SnippetCard 交互功能增强任务

## 任务概述

在已封装的 `SnippetCard` 组件基础上，添加交互功能，包括编辑/删除按钮和点击卡片跳转到详情页。

---

## 任务目标

1. **添加交互按钮**：创建 `SnippetActions` 客户端组件，提供编辑和删除功能
2. **实现点击跳转**：让卡片可点击跳转到详情页
3. **优化组件结构**：确保组件可复用性和良好的用户体验

---

## 实施计划

### 阶段一：创建详情页路由和页面

**目标**：先创建代码片段详情页，以便卡片可以跳转

**任务清单**：
- [ ] 创建详情页路由 `app/snippets/[id]/page.tsx`
- [ ] 实现详情页面，显示完整的代码片段信息
- [ ] 添加"返回列表"和"编辑"按钮
- [ ] 添加删除功能（带确认提示）

**技术要点**：
- 使用动态路由 `[id]` 获取 snippet ID
- 使用 `prisma.snippet.findUnique()` 获取单个 snippet 数据
- 处理 404 情况（snippet 不存在）
- 使用 Server Actions 或 API 路由实现删除功能

---

### 阶段二：创建 SnippetActions 客户端组件

**目标**：为卡片添加编辑和删除操作按钮

**文件**：`components/SnippetActions.tsx`

**功能要求**：
- [ ] 编辑按钮：跳转到编辑页面（或打开编辑模态框）
- [ ] 删除按钮：点击后显示确认提示，确认后删除
- [ ] 使用 Heroicons 图标（PencilIcon、TrashIcon）
- [ ] 按钮样式：简洁的图标按钮，hover 时显示背景色

**交互流程**：
1. 点击删除图标 → 显示确认对话框
2. 用户确认 → 调用删除 API
3. 删除成功 → 从列表中移除卡片（或刷新页面）

**技术方案**：
- 使用 `'use client'` 指令（客户端组件）
- 使用 `useState` 管理确认对话框状态
- 使用 `useRouter` 实现删除后刷新
- 可选：使用 Server Actions 简化删除逻辑

---

### 阶段三：集成 SnippetActions 到 SnippetCard

**目标**：将操作按钮嵌入到卡片头部

**修改文件**：`components/SnippetCard.tsx`

**任务清单**：
- [ ] 在卡片头部右侧添加 `SnippetActions` 组件
- [ ] 调整头部布局，确保按钮位置合理
- [ ] 传递 snippet ID 到 `SnippetActions`

**布局调整**：
```tsx
<div className="flex justify-between items-start mb-2">
  <h2 className="...">{snippet.title}</h2>
  <div className="flex items-center gap-2">
    <span className="...">{snippet.language}</span>
    <SnippetActions snippetId={snippet.id} />
  </div>
</div>
```

---

### 阶段四：实现点击卡片跳转

**目标**：点击卡片空白区域跳转到详情页

**修改文件**：`components/SnippetCard.tsx`

**方案 A：整张卡片包裹 Link（推荐）**
```tsx
<Link href={`/snippets/${snippet.id}`} className="block">
  <div className="break-inside-avoid ...">
    {/* 卡片内容 */}
  </div>
</Link>
```

**方案 B：仅内容区域可点击**
- 保持操作按钮不可点击（阻止事件冒泡）
- 卡片主体区域可点击

**注意事项**：
- 确保 `SnippetActions` 按钮点击时不触发跳转（阻止事件冒泡）
- 添加 hover 效果提示用户卡片可点击
- 考虑移动端体验

---

### 阶段五：创建编辑页面（可选）

**目标**：提供编辑功能入口

**文件**：`app/snippets/[id]/edit/page.tsx`

**功能要求**：
- [ ] 复用新建页面的表单组件
- [ ] 预填充现有数据
- [ ] 提交后更新数据库
- [ ] 提供保存和取消按钮

---

## 文件结构

```
app/
├── snippets/
│   └── [id]/
│       ├── page.tsx          # 详情页（新建）
│       └── edit/
│           └── page.tsx      # 编辑页（新建，可选）
└── page.tsx                  # 主页（已修改）

components/
├── SnippetCard.tsx           # 卡片组件（已修改）
├── SnippetActions.tsx        # 操作按钮组件（新建）
└── ui/
    └── DeleteConfirm.tsx     # 删除确认对话框（新建）
```

---

## 技术方案选择

### 删除功能实现方案

**方案 A：Server Actions（推荐）**
- 优点：简化客户端代码，类型安全
- 缺点：需要定义 `'use server'` 函数

**方案 B：API 路由 + fetch**
- 优点：灵活，便于复用
- 缺点：需要处理加载状态

**推荐使用 Server Actions**：
```typescript
// app/actions.ts
'use server';

export async function deleteSnippet(id: string) {
  await prisma.snippet.delete({ where: { id } });
  revalidatePath('/');
}
```

---

## UI/UX 设计要点

### 按钮样式
- 编辑按钮：蓝色 hover 效果
- 删除按钮：红色 hover 效果
- 图标大小：16-18px
- 过渡动画：200ms

### 确认对话框
- 标题："确认删除"
- 内容："删除后无法恢复，确定要删除这个代码片段吗？"
- 按钮：取消（次要）/ 删除（危险操作）

### 卡片 hover 效果
- 整张卡片：轻微上浮（-translate-y-1）
- 边框颜色变化
- 添加 cursor-pointer 提示可点击

---

## 测试计划

- [ ] 点击卡片跳转到详情页
- [ ] 编辑按钮跳转到编辑页（或打开编辑界面）
- [ ] 删除按钮显示确认对话框
- [ ] 确认删除后成功删除并刷新列表
- [ ] 取消删除后对话框关闭
- [ ] 删除不存在的 snippet 显示错误提示
- [ ] 移动端布局正常

---

## 后续优化

1. **添加加载状态**：删除时显示加载动画
2. **批量操作**：支持多选删除
3. **快捷键**：支持键盘快捷键操作
4. **动画效果**：删除卡片时添加淡出动画
5. **权限控制**：添加用户认证和权限验证

---

## 预计工作量

- 详情页创建：30 分钟
- SnippetActions 组件：30 分钟
- 集成和调整：20 分钟
- 测试和优化：20 分钟

**总计**：约 1.5-2 小时

---

## 参考资源

- Next.js 动态路由：https://nextjs.org/docs/app/building-your-application/routing/dynamic-routes
- Server Actions：https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations
- Heroicons：https://heroicons.com/
