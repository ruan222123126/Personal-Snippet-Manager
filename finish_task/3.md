å¤ªæ£’äº†ï¼Œç¬¬äºŒé˜¶æ®µå®Œæˆå¾—éå¸¸æ‰Qrå®ã€‚å°¤å…¶æ˜¯ FTS5 çš„ Trigger ä¿®å¤å’Œ API çš„äº‹åŠ¡é€»è¾‘ï¼Œè¿™æ˜¯ç³»ç»Ÿç¨³å®šè¿è¡Œçš„åŸºçŸ³ã€‚

ç°åœ¨è¿›å…¥ **ç¬¬ä¸‰é˜¶æ®µï¼šå‰ç«¯ UI æ„å»ºä¸äº¤äº’å®ç° (Frontend UI & Interaction)**ã€‚

è¿™ä¸€æ­¥çš„ç›®æ ‡æ˜¯ï¼šè®©å†·å†°å†°çš„æ•°æ®ä»¥ä¼˜ç¾çš„â€œç€‘å¸ƒæµâ€å½¢å¼å±•ç¤ºå‡ºæ¥ï¼Œå¹¶æŠŠä½ åœ¨ç¬¬äºŒé˜¶æ®µå†™çš„ `highlightCode` æœåŠ¡ç«¯é€»è¾‘çœŸæ­£ç”¨èµ·æ¥ã€‚

è¯·æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š

### ç¬¬ä¸‰é˜¶æ®µï¼šæ„å»ºç”¨æˆ·ç•Œé¢

#### 1. å®‰è£…å¿…è¦çš„ UI ä¾èµ–

æˆ‘ä»¬éœ€è¦å›¾æ ‡åº“å’Œé˜²æŠ–é’©å­ï¼ˆç”¨äºæœç´¢æ¡†ï¼‰ã€‚

* **åŠ¨ä½œ**ï¼šåœ¨ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```bash
npm install @heroicons/react use-debounce clsx tailwind-merge

```



#### 2. æå–æ•°æ®æŸ¥è¯¢é€»è¾‘ (Refactor)

ä¸ºäº†è®© **Web é¡µé¢** (Server Component) å’Œ **API** (ä¾› CLI ä½¿ç”¨) å¤ç”¨åŒä¸€å¥—å¤æ‚çš„æœç´¢é€»è¾‘ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒæŠ½ç¦»å‡ºæ¥ã€‚

* **åŠ¨ä½œ**ï¼šæ–°å»º `lib/data.ts`ã€‚
* **ä»»åŠ¡**ï¼š
* å°† `app/api/snippets/route.ts` ä¸­çš„ GET é€»è¾‘ï¼ˆFTSæœç´¢ã€æ ‡ç­¾è¿‡æ»¤ã€é»˜è®¤åˆ—è¡¨ï¼‰å‰ªåˆ‡å¹¶å°è£…æˆä¸€ä¸ªå‡½æ•° `getSnippets(query?: string, tag?: string)`ã€‚
* **è¿”å›ç±»å‹**ï¼šç¡®ä¿åŒ…å« `tags` å…³è”ã€‚
* ä¿®æ”¹åŸ API æ–‡ä»¶å’Œæ–°çš„ `app/page.tsx` æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚



#### 3. æ„å»ºâ€œäº¤äº’å²›å±¿â€ç»„ä»¶

Next.js App Router çš„ç²¾é«“åœ¨äºåŠ¨é™åˆ†ç¦»ã€‚

* **åŠ¨ä½œ**ï¼šåœ¨ `components/ui/` ä¸‹åˆ›å»ºä»¥ä¸‹ç»„ä»¶ï¼š
* `CopyButton.tsx` (**Client Component**):
* ä½¿ç”¨ `"use client"`ã€‚
* æ¥æ”¶ `code` å­—ç¬¦ä¸²ã€‚
* ä½¿ç”¨ `navigator.clipboard.writeText` å®ç°å¤åˆ¶ï¼Œç‚¹å‡»åå›¾æ ‡å˜ä¸ºâ€œå¯¹å·â€ã€‚


* `CodeBlock.tsx` (**Server Component**):
* **ä¸è¦**å†™ `"use client"`ã€‚
* å¼•å…¥ `lib/shiki` ä¸­çš„ `highlightCode`ã€‚
* å¼‚æ­¥è°ƒç”¨ `await highlightCode(code, language)` ç”Ÿæˆ HTMLã€‚
* å°†ç”Ÿæˆçš„ HTML é€šè¿‡ `dangerouslySetInnerHTML` æ¸²æŸ“ã€‚
* **åµŒå…¥** `CopyButton` ç»„ä»¶ï¼ˆè¿™æ˜¯æœåŠ¡ç«¯ç»„ä»¶åŒ…å«å®¢æˆ·ç«¯ç»„ä»¶çš„ç»å…¸ç”¨æ³•ï¼‰ã€‚





#### 4. å®ç°ç€‘å¸ƒæµä¸»é¡µ

* **åŠ¨ä½œ**ï¼šé‡å†™ `app/page.tsx`ã€‚
* **ä»»åŠ¡**ï¼š
* å®ƒæ˜¯ **Server Component**ã€‚
* æ¥æ”¶ `searchParams` (Next.js é»˜è®¤æ³¨å…¥)ã€‚
* è°ƒç”¨ `getSnippets` è·å–æ•°æ®ã€‚
* **å¸ƒå±€å…³é”®**ï¼šä½¿ç”¨ Tailwind çš„ `columns-1 md:columns-2 lg:columns-3 gap-6 space-y-6` å®ç°çº¯ CSS ç€‘å¸ƒæµã€‚
* éå†æ•°æ®æ¸²æŸ“ Snippet å¡ç‰‡ï¼ˆå¯ä»¥ç›´æ¥åœ¨ page é‡Œå†™å¡ç‰‡ç»“æ„ï¼ŒåŒ…å« `CodeBlock` å’Œ æ ‡ç­¾åˆ—è¡¨ï¼‰ã€‚



#### 5. å®ç°å³æ—¶æœç´¢

* **åŠ¨ä½œ**ï¼šåˆ›å»º `components/ui/SearchBar.tsx` (**Client Component**)ã€‚
* **é€»è¾‘**ï¼š
* ä½¿ç”¨ `useSearchParams`, `usePathname`, `useRouter`ã€‚
* ä½¿ç”¨ `useDebounce` (300ms) ç›‘å¬è¾“å…¥ã€‚
* å½“è¾“å…¥å˜åŒ–æ—¶ï¼Œä½¿ç”¨ `router.replace` æ›´æ–° URL å‚æ•°ï¼ˆ`?q=xxx`ï¼‰ï¼ŒæœåŠ¡ç«¯ç»„ä»¶ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“åˆ—è¡¨ã€‚



---

### ğŸ’¡ æ ¸å¿ƒä»£ç å‚è€ƒ (Code Snippets)

**1. `lib/data.ts` (æŠ½ç¦»åçš„é€»è¾‘)**

```typescript
import { prisma } from '@/lib/prisma';

export async function getSnippets(query?: string, tag?: string) {
  if (query) {
    // FTS Search
    const rawIds = await prisma.$queryRaw<{ id: string }[]>`
      SELECT s.id FROM Snippet s
      INNER JOIN SnippetFTS fts ON s.rowid = fts.rowid
      WHERE SnippetFTS MATCH ${query}
      ORDER BY rank;
    `;
    const ids = rawIds.map(row => row.id);
    if (ids.length === 0) return [];
    
    return prisma.snippet.findMany({
      where: { id: { in: ids } },
      include: { tags: { include: { tag: true } } },
    });
  } 
  
  if (tag) {
    // Tag Filter
    return prisma.snippet.findMany({
      where: { tags: { some: { tag: { name: tag } } } },
      orderBy: { createdAt: 'desc' },
      include: { tags: { include: { tag: true } } },
    });
  }

  // Default List
  return prisma.snippet.findMany({
    take: 50,
    orderBy: { createdAt: 'desc' },
    include: { tags: { include: { tag: true } } },
  });
}

```

**2. `components/ui/CodeBlock.tsx` (æœåŠ¡ç«¯æ¸²æŸ“é«˜äº®)**

```typescript
import { highlightCode } from '@/lib/shiki';
import { CopyButton } from './CopyButton';

export async function CodeBlock({ code, language }: { code: string; language: string }) {
  const html = await highlightCode(code, language);

  return (
    <div className="relative group rounded-lg overflow-hidden border border-gray-200 bg-white dark:border-gray-800 dark:bg-[#0d1117]">
      <div className="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-10">
        <CopyButton code={code} />
      </div>
      <div 
        className="text-sm overflow-x-auto p-4 [&>pre]:!bg-transparent [&>pre]:!p-0"
        dangerouslySetInnerHTML={{ __html: html }} 
      />
    </div>
  );
}

```

---

### âœ… éªŒæ”¶æ ‡å‡†

å®Œæˆè¿™ä¸€æ­¥åï¼š

1. **é¡µé¢å¯è§**ï¼šè®¿é—® `http://localhost:3000` èƒ½çœ‹åˆ°ä½ ä¹‹å‰ç”¨ API å†™å…¥çš„æµ‹è¯•æ•°æ®ã€‚
2. **é«˜äº®ç”Ÿæ•ˆ**ï¼šä»£ç å—åº”è¯¥æ˜¯å½©è‰²çš„ï¼Œè€Œä¸æ˜¯é»‘ç™½æ–‡æœ¬ã€‚
3. **äº¤äº’å¯ç”¨**ï¼š
* ç‚¹å‡»å³ä¸Šè§’å¤åˆ¶æŒ‰é’®ï¼Œèƒ½æŠŠä»£ç å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚
* åœ¨æœç´¢æ¡†è¾“å…¥ "React"ï¼ˆæˆ–ä½ ä¹‹å‰çš„æ•°æ®å…³é”®è¯ï¼‰ï¼Œåˆ—è¡¨ä¼šè‡ªåŠ¨åˆ·æ–°è¿‡æ»¤ã€‚



**å®Œæˆåï¼Œè¯·æˆªå›¾ç»™æˆ‘çœ‹ä¸»é¡µçš„æ•ˆæœï¼Œæˆ–è€…æè¿°ä¸€ä¸‹ä½ çœ‹åˆ°çš„ç•Œé¢ã€‚**