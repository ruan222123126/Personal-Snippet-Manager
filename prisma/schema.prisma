generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Snippet {
  id          String         @id @default(cuid())
  title       String
  description String?
  code        String
  language    String
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  tutorial    String?
  tags        TagOnSnippet[]
}

model Tag {
  id        String         @id @default(cuid())
  name      String         @unique
  color     String?
  createdAt DateTime       @default(now())
  snippets  TagOnSnippet[]
}

model TagOnSnippet {
  id         String   @id @default(cuid())
  snippetId  String
  tagId      String
  assignedAt DateTime @default(now())
  tag        Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)
  snippet    Snippet  @relation(fields: [snippetId], references: [id], onDelete: Cascade)

  @@unique([snippetId, tagId])
}

model SearchHistory {
  id          String   @id @default(cuid())
  query       String
  filters     String?
  resultCount Int
  createdAt   DateTime @default(now())

  @@index([query], map: "SearchHistory.query_idx")
  @@index([createdAt], map: "SearchHistory.createdAt_idx")
}

model SearchStats {
  id             String   @id @default(cuid())
  query          String   @unique(map: "SearchStats.query_key")
  searchCount    Int      @default(0)
  lastSearchedAt DateTime @default(now())

  @@index([searchCount], map: "SearchStats.searchCount_idx")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model SnippetFTS {
  title       Unsupported("")?
  description Unsupported("")?
  code        Unsupported("")?
  language    Unsupported("")?
  tutorial    Unsupported("")?

  @@ignore
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model SnippetFTS_config {
  k Unsupported("")  @id
  v Unsupported("")?

  @@ignore
}

model SnippetFTS_data {
  id    Int    @id @default(autoincrement())
  block Bytes?
}

model SnippetFTS_docsize {
  id Int    @id @default(autoincrement())
  sz Bytes?
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model SnippetFTS_idx {
  segid Unsupported("")
  term  Unsupported("")
  pgno  Unsupported("")?

  @@id([segid, term])
  @@ignore
}
